# LifePill Microservices Architecture

[![API Gateway](https://img.shields.io/badge/submodule-api--gateway-blue)](https://github.com/Life-Pill/api-gateway)
[![Service Registry](https://img.shields.io/badge/submodule-service--registry-green)](https://github.com/Life-Pill/service-registry)
[![User Auth](https://img.shields.io/badge/submodule-user--auth-orange)](https://github.com/Life-Pill/mobile-auth-user-service)
[![Config Server](https://img.shields.io/badge/submodule-config--server-yellow)](https://github.com/Life-Pill/configuration-server)
[![Patient Customer Service](https://img.shields.io/badge/submodule-patient--customer--service-purple)](https://github.com/Life-Pill/patient-customer-service)

## ğŸ—ï¸ Production-Grade Microservices Platform

This repository contains a **production-grade microservices architecture** for the LifePill Pharmacy Management System. Built with Spring Cloud ecosystem, it follows industry best practices including Service Discovery, Centralized Configuration, API Gateway pattern, Circuit Breaker, Distributed Tracing, and comprehensive monitoring.

---

## ğŸ“ Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    LIFEPILL MICROSERVICES ARCHITECTURE                                            â”‚
â”‚                                         Production Environment                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                              EXTERNAL CLIENTS
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Mobile App    â”‚    â”‚    Web App      â”‚    â”‚   POS System    â”‚    â”‚   Admin Panel   â”‚
    â”‚   (Flutter)     â”‚    â”‚    (React)      â”‚    â”‚    (Desktop)    â”‚    â”‚    (React)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                      â”‚                      â”‚                      â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ HTTPS (Port 9191)
                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         ğŸšª API GATEWAY (Spring Cloud Gateway)                                     â”‚
â”‚                                                   Port: 9191                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Rate Limiting â”‚ â”‚ Circuit Breakerâ”‚ â”‚  Load Balancer â”‚ â”‚  CORS Handler  â”‚ â”‚ Request Router â”‚                  â”‚
â”‚  â”‚    (Redis)     â”‚ â”‚  (Resilience4j)â”‚ â”‚   (Ribbon)     â”‚ â”‚                â”‚ â”‚                â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                          â”‚                          â”‚
                    â–¼                          â–¼                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” SERVICE REGISTRY        â”‚  â”‚  âš™ï¸ CONFIG SERVER            â”‚  â”‚  ğŸ” DISTRIBUTED TRACING     â”‚
â”‚     (Netflix Eureka)        â”‚  â”‚     (Spring Cloud Config)   â”‚  â”‚     (Zipkin)                â”‚
â”‚     Port: 8761              â”‚  â”‚     Port: 8888              â”‚  â”‚     Port: 9411              â”‚
â”‚                             â”‚  â”‚                             â”‚  â”‚                             â”‚
â”‚  â€¢ Service Registration     â”‚  â”‚  â€¢ Centralized Config       â”‚  â”‚  â€¢ Request Tracing          â”‚
â”‚  â€¢ Health Monitoring        â”‚  â”‚  â€¢ Environment Profiles     â”‚  â”‚  â€¢ Latency Analysis         â”‚
â”‚  â€¢ Load Balancing Info      â”‚  â”‚  â€¢ Runtime Refresh          â”‚  â”‚  â€¢ Dependency Mapping       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–²                          â–²                          â–²
                    â”‚    Register & Heartbeat  â”‚    Pull Configuration    â”‚    Send Traces
                    â”‚                          â”‚                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         ğŸ¢ BUSINESS MICROSERVICES LAYER                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ ğŸ‘¤ USER AUTH        â”‚  â”‚ ğŸ¥ PATIENT CUSTOMER â”‚  â”‚ ğŸª BRANCH SERVICE   â”‚  â”‚ ğŸ“¦ INVENTORY        â”‚              â”‚
â”‚  â”‚    SERVICE          â”‚  â”‚    SERVICE          â”‚  â”‚                     â”‚  â”‚    SERVICE          â”‚              â”‚
â”‚  â”‚    Port: 8080       â”‚  â”‚    Port: 8070       â”‚  â”‚    Port: 8081       â”‚  â”‚    Port: 8082       â”‚              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â”‚ â€¢ Mobile Auth       â”‚  â”‚ â€¢ Patient Records   â”‚  â”‚ â€¢ Branch Management â”‚  â”‚ â€¢ Stock Management  â”‚              â”‚
â”‚  â”‚ â€¢ JWT Tokens        â”‚  â”‚ â€¢ Prescriptions     â”‚  â”‚ â€¢ Location Data     â”‚  â”‚ â€¢ Product Catalog   â”‚              â”‚
â”‚  â”‚ â€¢ Email OTP         â”‚  â”‚ â€¢ Stripe Payments   â”‚  â”‚ â€¢ Operating Hours   â”‚  â”‚ â€¢ Alerts & Reports  â”‚              â”‚
â”‚  â”‚ â€¢ Password Reset    â”‚  â”‚ â€¢ Customer Profile  â”‚  â”‚                     â”‚  â”‚                     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚             â”‚                        â”‚                        â”‚                        â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚ ğŸªª IDENTITY         â”‚  â”‚ ğŸ›’ ORDER SERVICE    â”‚  â”‚                     â”‚                                       â”‚
â”‚  â”‚    SERVICE          â”‚  â”‚    (POS System)     â”‚  â”‚   Future Services   â”‚                                       â”‚
â”‚  â”‚    Port: 8085       â”‚  â”‚    Port: 8086       â”‚  â”‚                     â”‚                                       â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚ â€¢ Notification      â”‚                                       â”‚
â”‚  â”‚ â€¢ Employee Auth     â”‚  â”‚ â€¢ Order Processing  â”‚  â”‚ â€¢ Analytics         â”‚                                       â”‚
â”‚  â”‚ â€¢ PIN Authenticationâ”‚  â”‚ â€¢ Transactions      â”‚  â”‚ â€¢ Reporting         â”‚                                       â”‚
â”‚  â”‚ â€¢ Session Caching   â”‚  â”‚ â€¢ Receipt Gen       â”‚  â”‚                     â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚             â”‚                        â”‚                                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                        â”‚
              â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                           ğŸ’¾ DATA LAYER                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚  â”‚ ğŸ˜ PostgreSQL       â”‚  â”‚ ğŸƒ MongoDB          â”‚  â”‚ ğŸ”´ Redis            â”‚                                       â”‚
â”‚  â”‚    Port: 5432       â”‚  â”‚    Port: 27017      â”‚  â”‚    Port: 6379       â”‚                                       â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚                     â”‚                                       â”‚
â”‚  â”‚ DATABASES:          â”‚  â”‚ COLLECTIONS:        â”‚  â”‚ USAGE:              â”‚                                       â”‚
â”‚  â”‚ â€¢ mobile_user_auth  â”‚  â”‚ â€¢ lifepill_customer â”‚  â”‚ â€¢ Session Cache     â”‚                                       â”‚
â”‚  â”‚ â€¢ identity_service  â”‚  â”‚ â€¢ prescriptions     â”‚  â”‚ â€¢ Rate Limiting     â”‚                                       â”‚
â”‚  â”‚ â€¢ branch_service    â”‚  â”‚ â€¢ medical_records   â”‚  â”‚ â€¢ Token Blacklist   â”‚                                       â”‚
â”‚  â”‚ â€¢ inventory_service â”‚  â”‚                     â”‚  â”‚                     â”‚                                       â”‚
â”‚  â”‚ â€¢ order_service     â”‚  â”‚                     â”‚  â”‚                     â”‚                                       â”‚
â”‚  â”‚ â€¢ customer_service  â”‚  â”‚                     â”‚  â”‚                     â”‚                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         ğŸ“Š OBSERVABILITY STACK                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ ğŸ“ˆ Prometheus       â”‚  â”‚ ğŸ“Š Grafana          â”‚  â”‚ ğŸ” Zipkin           â”‚  â”‚ ğŸ“¤ Exporters        â”‚              â”‚
â”‚  â”‚    Port: 9090       â”‚  â”‚    Port: 3001       â”‚  â”‚    Port: 9411       â”‚  â”‚                     â”‚              â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚ â€¢ PostgreSQL :9187  â”‚              â”‚
â”‚  â”‚ â€¢ Metrics Scraping  â”‚  â”‚ â€¢ Dashboards        â”‚  â”‚ â€¢ Trace Collection  â”‚  â”‚ â€¢ Redis :9121       â”‚              â”‚
â”‚  â”‚ â€¢ Alert Rules       â”‚  â”‚ â€¢ Visualization     â”‚  â”‚ â€¢ Service Map       â”‚  â”‚ â€¢ MongoDB :9216     â”‚              â”‚
â”‚  â”‚ â€¢ Time Series DB    â”‚  â”‚ â€¢ Alerting          â”‚  â”‚ â€¢ Latency Analysis  â”‚  â”‚                     â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Request Flow - How a Request Reaches a Service

### Complete Request Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              REQUEST FLOW: Client â†’ Service â†’ Response                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 CLIENT                    API GATEWAY                SERVICE REGISTRY              TARGET SERVICE
    â”‚                          â”‚                            â”‚                            â”‚
    â”‚  1. HTTP Request         â”‚                            â”‚                            â”‚
    â”‚  GET /api/user-auth/...  â”‚                            â”‚                            â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                            â”‚                            â”‚
    â”‚                          â”‚                            â”‚                            â”‚
    â”‚                          â”‚  2. Rate Limit Check       â”‚                            â”‚
    â”‚                          â”‚  (Redis)                   â”‚                            â”‚
    â”‚                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚                            â”‚
    â”‚                          â”‚         â”‚ Check            â”‚                            â”‚
    â”‚                          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Quota            â”‚                            â”‚
    â”‚                          â”‚                            â”‚                            â”‚
    â”‚                          â”‚  3. Lookup Service         â”‚                            â”‚
    â”‚                          â”‚  Location                  â”‚                            â”‚
    â”‚                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                            â”‚
    â”‚                          â”‚                            â”‚                            â”‚
    â”‚                          â”‚  4. Return Healthy         â”‚                            â”‚
    â”‚                          â”‚  Instance List             â”‚                            â”‚
    â”‚                          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
    â”‚                          â”‚                            â”‚                            â”‚
    â”‚                          â”‚  5. Load Balance &         â”‚                            â”‚
    â”‚                          â”‚  Forward Request           â”‚                            â”‚
    â”‚                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                          â”‚                            â”‚                            â”‚
    â”‚                          â”‚                            â”‚   6. Process Request       â”‚
    â”‚                          â”‚                            â”‚   - Validate JWT           â”‚
    â”‚                          â”‚                            â”‚   - Business Logic         â”‚
    â”‚                          â”‚                            â”‚   - Database Query         â”‚
    â”‚                          â”‚                            â”‚                            â”‚
    â”‚                          â”‚  7. Service Response       â”‚                            â”‚
    â”‚                          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                          â”‚                            â”‚                            â”‚
    â”‚                          â”‚  8. Circuit Breaker        â”‚                            â”‚
    â”‚                          â”‚  Health Update             â”‚                            â”‚
    â”‚                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚                            â”‚
    â”‚                          â”‚         â”‚ Record           â”‚                            â”‚
    â”‚                          â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Metrics          â”‚                            â”‚
    â”‚                          â”‚                            â”‚                            â”‚
    â”‚  9. HTTP Response        â”‚                            â”‚                            â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚                            â”‚
    â”‚                          â”‚                            â”‚                            â”‚

PARALLEL: Zipkin Trace Propagation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Zipkin Server
```

### Step-by-Step Request Processing

| Step | Component | Action | Details |
|------|-----------|--------|---------|
| **1** | Client | Send Request | HTTP/HTTPS request to `http://34.59.6.212:9191/api/{service}/{endpoint}` |
| **2** | API Gateway | Rate Limiting | Check Redis for request quota (prevents DDoS) |
| **3** | API Gateway | Service Discovery | Query Eureka for available service instances |
| **4** | Eureka | Return Instances | Provide list of healthy service instances |
| **5** | API Gateway | Load Balancing | Select instance using Round Robin / Weighted algorithm |
| **6** | Target Service | Process Request | JWT validation â†’ Business logic â†’ Database query |
| **7** | Target Service | Return Response | Send response back through gateway |
| **8** | API Gateway | Circuit Breaker | Update health metrics, trip breaker if errors exceed threshold |
| **9** | Client | Receive Response | Final HTTP response with data |

---

## ğŸ›£ï¸ API Gateway Routing Configuration

### Route Mapping Table

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    API GATEWAY ROUTE CONFIGURATION                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                          â”‚
â”‚  INCOMING REQUEST                          ROUTED TO                          SERVICE                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€                   â”‚
â”‚                                                                                                          â”‚
â”‚  /api/user-auth/**        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ lb://USER-AUTH          â”€â”€â”€â”€â”€â”€â”€â–¶  User Auth (8080)          â”‚
â”‚  /api/identity/**         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ lb://IDENTITY-SERVICE   â”€â”€â”€â”€â”€â”€â”€â–¶  Identity (8085)           â”‚
â”‚  /api/customer/**         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ lb://PATIENT-CUSTOMER   â”€â”€â”€â”€â”€â”€â”€â–¶  Patient Customer (8070)   â”‚
â”‚  /api/branch/**           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ lb://BRANCH-SERVICE     â”€â”€â”€â”€â”€â”€â”€â–¶  Branch (8081)             â”‚
â”‚  /api/inventory/**        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ lb://INVENTORY-SERVICE  â”€â”€â”€â”€â”€â”€â”€â–¶  Inventory (8082)          â”‚
â”‚  /api/order/**            â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ lb://ORDER-SERVICE      â”€â”€â”€â”€â”€â”€â”€â–¶  Order (8086)              â”‚
â”‚                                                                                                          â”‚
â”‚  Note: "lb://" = Load Balanced (Service Discovery enabled)                                              â”‚
â”‚                                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Example Request Flows

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXAMPLE 1: Mobile App Login (User Auth Service)                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                          â”‚
â”‚  Mobile App                                                                                              â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â”‚  POST http://34.59.6.212:9191/api/user-auth/v1/auth/login                                        â”‚
â”‚      â”‚  Body: { "email": "user@test.com", "password": "..." }                                           â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â–¼                                                                                                   â”‚
â”‚  API Gateway (9191)                                                                                      â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â”‚  Route: /api/user-auth/** â†’ lb://USER-AUTH                                                       â”‚
â”‚      â”‚  Strip Prefix: /api/user-auth                                                                    â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â–¼                                                                                                   â”‚
â”‚  User Auth Service (8080)                                                                                â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â”‚  Internal: POST /v1/auth/login                                                                   â”‚
â”‚      â”‚  â€¢ Validate credentials against PostgreSQL                                                       â”‚
â”‚      â”‚  â€¢ Generate JWT access + refresh tokens                                                          â”‚
â”‚      â”‚  â€¢ Return tokens to client                                                                       â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â–¼                                                                                                   â”‚
â”‚  Response: { "accessToken": "eyJ...", "refreshToken": "eyJ...", "user": {...} }                         â”‚
â”‚                                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXAMPLE 2: POS System Employee Login (Identity Service + Redis)                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                          â”‚
â”‚  POS Desktop App                                                                                         â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â”‚  POST http://34.59.6.212:9191/api/identity/lifepill/v1/auth/authenticate                         â”‚
â”‚      â”‚  Body: { "employerEmail": "emp@lifepill.com", "employerPassword": "..." }                        â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â–¼                                                                                                   â”‚
â”‚  API Gateway (9191)                                                                                      â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â”‚  Route: /api/identity/** â†’ lb://IDENTITY-SERVICE                                                 â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â–¼                                                                                                   â”‚
â”‚  Identity Service (8085)                                                                                 â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â”œâ”€â”€â–¶ PostgreSQL: Verify employee credentials                                                       â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â”œâ”€â”€â–¶ Redis: Cache session { token, user, pin, expiry }                                             â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â–¼                                                                                                   â”‚
â”‚  Response: { "token": "eyJ...", "employer": {...}, "sessionId": "..." }                                 â”‚
â”‚                                                                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                                                                          â”‚
â”‚  QUICK RE-LOGIN (PIN from Redis Cache):                                                                  â”‚
â”‚                                                                                                          â”‚
â”‚  POST /api/identity/lifepill/v1/session/authenticate/cached                                             â”‚
â”‚  Body: { "username": "emp@lifepill.com", "pin": 1234 }                                                  â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â–¼                                                                                                   â”‚
â”‚  Identity Service â†’ Redis (Check cached PIN) â†’ Return cached session                                    â”‚
â”‚                                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXAMPLE 3: Customer Payment (Patient Customer Service + Stripe)                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                          â”‚
â”‚  Web App                                                                                                 â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â”‚  POST http://34.59.6.212:9191/api/customer/payments/create                                       â”‚
â”‚      â”‚  Headers: { Authorization: "Bearer eyJ..." }                                                     â”‚
â”‚      â”‚  Body: { "amount": 150.00, "customerId": "cust_123" }                                            â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â–¼                                                                                                   â”‚
â”‚  API Gateway (9191)                                                                                      â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â”‚  â€¢ Relay Authorization header                                                                    â”‚
â”‚      â”‚  â€¢ Route: /api/customer/** â†’ lb://PATIENT-CUSTOMER                                               â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â–¼                                                                                                   â”‚
â”‚  Patient Customer Service (8070)                                                                         â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â”œâ”€â”€â–¶ MongoDB: Fetch customer profile                                                               â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â”œâ”€â”€â–¶ Stripe API: Create PaymentIntent                                                              â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â”œâ”€â”€â–¶ PostgreSQL: Record transaction                                                                â”‚
â”‚      â”‚                                                                                                   â”‚
â”‚      â–¼                                                                                                   â”‚
â”‚  Response: { "paymentIntentId": "pi_...", "clientSecret": "pi_..._secret_..." }                         â”‚
â”‚                                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Service Discovery (Pull Architecture)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    PULL-BASED SERVICE DISCOVERY                                          â”‚
â”‚                                       (Netflix Eureka Pattern)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚    EUREKA SERVER        â”‚
                                    â”‚      (Port 8761)        â”‚
                                    â”‚                         â”‚
                                    â”‚  Service Registry:      â”‚
                                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                                    â”‚  â”‚ USER-AUTH         â”‚  â”‚
                                    â”‚  â”‚  â””â”€ 8080 (healthy)â”‚  â”‚
                                    â”‚  â”‚ IDENTITY-SERVICE  â”‚  â”‚
                                    â”‚  â”‚  â””â”€ 8085 (healthy)â”‚  â”‚
                                    â”‚  â”‚ PATIENT-CUSTOMER  â”‚  â”‚
                                    â”‚  â”‚  â””â”€ 8070 (healthy)â”‚  â”‚
                                    â”‚  â”‚ BRANCH-SERVICE    â”‚  â”‚
                                    â”‚  â”‚  â””â”€ 8081 (healthy)â”‚  â”‚
                                    â”‚  â”‚ INVENTORY-SERVICE â”‚  â”‚
                                    â”‚  â”‚  â””â”€ 8082 (healthy)â”‚  â”‚
                                    â”‚  â”‚ ORDER-SERVICE     â”‚  â”‚
                                    â”‚  â”‚  â””â”€ 8086 (healthy)â”‚  â”‚
                                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚                           â”‚
            1. REGISTER                 2. PULL REGISTRY            3. HEARTBEAT
            (On Startup)                (Every 30 sec)              (Every 30 sec)
                    â”‚                           â”‚                           â”‚
                    â–¼                           â–¼                           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚   MICROSERVICE        â”‚     â”‚     API GATEWAY       â”‚                â”‚
    â”‚   (Any Service)       â”‚     â”‚      (Port 9191)      â”‚                â”‚
    â”‚                       â”‚     â”‚                       â”‚                â”‚
    â”‚ On startup:           â”‚     â”‚ Cached Registry:      â”‚                â”‚
    â”‚ â€¢ Register with       â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                â”‚
    â”‚   Eureka              â”‚     â”‚ â”‚ USER-AUTH: 8080   â”‚ â”‚                â”‚
    â”‚ â€¢ Send metadata       â”‚     â”‚ â”‚ IDENTITY: 8085    â”‚ â”‚                â”‚
    â”‚   (host, port, health)â”‚     â”‚ â”‚ PATIENT: 8070     â”‚ â”‚                â”‚
    â”‚                       â”‚     â”‚ â”‚ ...               â”‚ â”‚                â”‚
    â”‚ Every 30 seconds:     â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                â”‚
    â”‚ â€¢ Send heartbeat â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                       â”‚     â”‚                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ Uses cache to route   â”‚
                                  â”‚ requests instantly    â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FLOW EXPLANATION:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. SERVICE REGISTRATION: When a microservice starts, it registers itself with Eureka
   including its service name, host, port, and health check URL.

2. REGISTRY PULL: API Gateway pulls the full service registry every 30 seconds
   and caches it locally for fast routing decisions.

3. HEARTBEAT: Each service sends a heartbeat to Eureka every 30 seconds.
   If missed 3 times (90 sec), the service is marked as DOWN and removed.

4. SELF-PRESERVATION: If >85% of instances miss heartbeats (network partition),
   Eureka enters self-preservation mode and keeps registrations.
```

---

## ğŸ“‚ Repository Structure (Git Submodules)

This is a **monorepo** that links to the following microservices as Git submodules:

| Submodule | Repository | Description | Port |
|-----------|------------|-------------|------|
| [`api-gateway`](./api-gateway) | [Life-Pill/api-gateway](https://github.com/Life-Pill/api-gateway) | Spring Cloud Gateway with Circuit Breaker | 9191 |
| [`service-registry`](./service-registry) | [Life-Pill/service-registry](https://github.com/Life-Pill/service-registry) | Netflix Eureka Server | 8761 |
| [`config-server`](./config-server) | [Life-Pill/configuration-server](https://github.com/Life-Pill/configuration-server) | Spring Cloud Config Server | 8888 |
| [`user-auth`](./user-auth) | [Life-Pill/mobile-auth-user-service](https://github.com/Life-Pill/mobile-auth-user-service) | JWT Authentication Service (Mobile) | 8080 |
| [`patient-customer-service`](./patient-customer-service) | [Life-Pill/patient-web-customer-service](https://github.com/Life-Pill/patient-web-customer-service) | Patient & Customer Management | 8070 |

### Additional Services (Non-Submodule)

| Service | Location | Description | Port |
|---------|----------|-------------|------|
| `employee-identity-service` | `./employee-identity-service` | Employee Auth with Redis Session | 8085 |
| `branch-service` | `./branch-service` | Branch Management | 8081 |
| `inventory-service` | `./inventory-service` | Inventory Management | 8082 |
| `order-service` | `./pharmacy-pos-main-backend/order-system` | Order Processing & POS | 8086 |

### ğŸ”„ Cloning with Submodules

```bash
# Clone with all submodules
git clone --recurse-submodules https://github.com/Life-Pill/mobile-ms.git

# Or if already cloned, initialize submodules
git submodule init
git submodule update

# Update all submodules to latest
git submodule update --remote --merge
```

---

## ğŸ“‹ Services Overview

### Business Services

| Service | Port | Description | Database |
|---------|------|-------------|----------|
| **User Auth Service** | 8080 | JWT-based authentication for mobile apps | PostgreSQL |
| **Identity Service** | 8085 | Employee auth with PIN & Redis session caching | PostgreSQL + Redis |
| **Patient Customer Service** | 8070 | Patient records, prescriptions, Stripe payments | PostgreSQL + MongoDB |
| **Branch Service** | 8081 | Branch management, locations, operating hours | PostgreSQL |
| **Inventory Service** | 8082 | Stock management, product catalog, alerts | PostgreSQL |
| **Order Service** | 8086 | Order processing, transactions, receipts | PostgreSQL |

### Infrastructure Services

| Service | Port | Description |
|---------|------|-------------|
| **Service Registry** | 8761 | Netflix Eureka Server for service discovery |
| **Config Server** | 8888 | Centralized configuration management |
| **API Gateway** | 9191 | Single entry point with routing, load balancing, circuit breaker |

### Data Stores

| Service | Port | Description |
|---------|------|-------------|
| **PostgreSQL** | 5432 | Primary relational database |
| **MongoDB** | 27017 | Document database for patient records |
| **Redis** | 6379 | Session caching and rate limiting |

### Observability Stack

| Service | Port | Description |
|---------|------|-------------|
| **Prometheus** | 9090 | Metrics collection and alerting |
| **Grafana** | 3001 | Metrics visualization dashboards |
| **Zipkin** | 9411 | Distributed tracing |
| **PostgreSQL Exporter** | 9187 | PostgreSQL metrics for Prometheus |
| **Redis Exporter** | 9121 | Redis metrics for Prometheus |
| **MongoDB Exporter** | 9216 | MongoDB metrics for Prometheus |

## Pull Architecture (Service Discovery)

The system uses **Pull-based Service Discovery** via Netflix Eureka:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PULL ARCHITECTURE                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          1. Register              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚   Service   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Eureka Server  â”‚     â”‚
â”‚   â”‚  (on start) â”‚                                   â”‚    (8761)       â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚              â”‚
â”‚                                                              â”‚              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         2. Pull Registry          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚ API Gateway â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Service List  â”‚      â”‚
â”‚   â”‚   (9191)    â”‚         (Every 30 sec)           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â”‚ 3. Route Request (with cached registry)                         â”‚
â”‚          â”‚                                                                  â”‚
â”‚          â–¼                                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚                      MICROSERVICES                                â”‚     â”‚
â”‚   â”‚                                                                   â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚
â”‚   â”‚  â”‚ Identity  â”‚  â”‚   User    â”‚  â”‚  Patient  â”‚  â”‚   Order   â”‚     â”‚     â”‚
â”‚   â”‚  â”‚  Service  â”‚  â”‚   Auth    â”‚  â”‚  Service  â”‚  â”‚  Service  â”‚     â”‚     â”‚
â”‚   â”‚  â”‚  (8085)   â”‚  â”‚  (8080)   â”‚  â”‚  (8070)   â”‚  â”‚  (8086)   â”‚     â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚
â”‚   â”‚                                                                   â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚     â”‚
â”‚   â”‚  â”‚  Branch   â”‚  â”‚ Inventory â”‚                                    â”‚     â”‚
â”‚   â”‚  â”‚  Service  â”‚  â”‚  Service  â”‚                                    â”‚     â”‚
â”‚   â”‚  â”‚  (8081)   â”‚  â”‚  (8082)   â”‚                                    â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PULL FLOW:
1. Services REGISTER themselves with Eureka on startup
2. API Gateway PULLS the service registry every 30 seconds
3. Gateway uses CACHED registry to route requests to services
4. If a service goes down, it's removed from registry after heartbeat timeout
```

## Session Management Architecture (Redis Caching)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SESSION MANAGEMENT FLOW                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    1. Login (password)     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Client  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Identity   â”‚                   â”‚
â”‚  â”‚  (POS)   â”‚                            â”‚   Service    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â”‚                                         â”‚                           â”‚
â”‚       â”‚                                         â”‚ 2. Authenticate           â”‚
â”‚       â”‚                                         â”‚    & Generate JWT         â”‚
â”‚       â”‚                                         â–¼                           â”‚
â”‚       â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚       â”‚                                  â”‚  PostgreSQL  â”‚                   â”‚
â”‚       â”‚                                  â”‚   (5432)     â”‚                   â”‚
â”‚       â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â”‚                                         â”‚                           â”‚
â”‚       â”‚                                         â”‚ 3. Cache Session          â”‚
â”‚       â”‚                                         â–¼                           â”‚
â”‚       â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚       â”‚                                  â”‚    Redis     â”‚                   â”‚
â”‚       â”‚    â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   (6379)     â”‚                   â”‚
â”‚       â”‚    4. Return JWT + Session       â”‚              â”‚                   â”‚
â”‚       â”‚                                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                   â”‚
â”‚       â”‚                                  â”‚  â”‚Session â”‚  â”‚                   â”‚
â”‚       â”‚                                  â”‚  â”‚ Data:  â”‚  â”‚                   â”‚
â”‚       â”‚                                  â”‚  â”‚ -token â”‚  â”‚                   â”‚
â”‚       â”‚                                  â”‚  â”‚ -user  â”‚  â”‚                   â”‚
â”‚       â”‚                                  â”‚  â”‚ -expiryâ”‚  â”‚                   â”‚
â”‚       â”‚                                  â”‚  â”‚-revokedâ”‚  â”‚                   â”‚
â”‚       â”‚                                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚
â”‚       â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”‚    5. Re-login with PIN (from cache)                               â”‚
â”‚       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                         â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”‚    â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚       â”‚    6. Return cached session                                        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SESSION OPERATIONS:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Temporary Logout  â”‚ Keep cache data, set DB inactive           â”‚
â”‚                   â”‚ User can re-login with PIN                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Permanent Logout  â”‚ Delete cache data, set DB inactive         â”‚
â”‚                   â”‚ User must login with password              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Session Valid     â”‚ revoked == false AND expiresAt > now()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Identity Service Session Endpoints

| Method | Endpoint | Request Body | Description |
|--------|----------|--------------|-------------|
| POST | `/lifepill/v1/auth/authenticate` | `{"employerEmail": "...", "employerPassword": "..."}` | Login with password (caches session) |
| POST | `/lifepill/v1/auth/authenticate-pin` | `{"employerEmail": "...", "pin": 1234}` | Login with PIN (caches session) |
| POST | `/lifepill/v1/session/authenticate/cached` | `{"username": "...", "pin": 1234}` | Re-login from cache with PIN |
| POST | `/lifepill/v1/session/logout/temporary` | `{"username": "..."}` | Temporary logout (keeps cache) |
| POST | `/lifepill/v1/session/logout/permanent` | `{"username": "..."}` | Permanent logout (removes cache) |
| GET | `/lifepill/v1/session/get-cached-employer/email/{email}` | - | Get cached session by email |
| GET | `/lifepill/v1/session/get-all-cached-employers` | - | Get all cached sessions |
| GET | `/lifepill/v1/session/check/{email}` | - | Check if session is valid |

## Startup Order

**Important:** Services must be started in the following order:

```
1. PostgreSQL, MongoDB, Redis - Infrastructure
2. Service Registry (Eureka Server) - Port 8761
3. Config Server - Port 8888
4. Zipkin - Port 9411
5. API Gateway - Port 9191
6. Identity Service - Port 8085
7. User Auth Service - Port 8080
8. Patient Customer Service - Port 8070
9. Other Services...
10. Prometheus, Grafana - Monitoring
```

## ğŸ”§ Configuration

### Environment Variables

Each service requires specific environment variables. Copy the `.env.example` files to `.env` and configure:

#### Service Registry
```bash
EUREKA_PORT=8761
EUREKA_USERNAME=admin
EUREKA_PASSWORD=your-secure-password
```

#### Config Server
```bash
CONFIG_SERVER_PORT=8888
CONFIG_SERVER_USERNAME=configuser
CONFIG_SERVER_PASSWORD=your-secure-password
EUREKA_URI=http://localhost:8761/eureka/
```

#### API Gateway
```bash
API_GATEWAY_PORT=9191
EUREKA_URI=http://localhost:8761/eureka/
CORS_ORIGINS=http://localhost:3000,http://localhost:8081
```

#### User Auth Service
```bash
DB_URL=jdbc:postgresql://localhost:5432/mobile_user_auth_db
DB_USERNAME=postgres
DB_PASSWORD=your-db-password
JWT_SECRET=your-jwt-secret-key
EUREKA_URI=http://localhost:8761/eureka/
```

#### Identity Service
```bash
DB_URL=jdbc:postgresql://localhost:5432/identity_service_db
REDIS_HOST=localhost
REDIS_PORT=6379
JWT_SECRET=your-jwt-secret-key
EUREKA_URI=http://localhost:8761/eureka/
```

## ğŸƒâ€â™‚ï¸ Running the Services

### Using Docker Compose

```bash
# Copy environment file and configure
cp .env.example .env

# Build and start all services
docker compose --env-file .env up -d

# View logs
docker compose logs -f

# Stop all services
docker compose down
```

## Quick Start with Docker

```bash
# 1. Clone repository
git clone --recurse-submodules https://github.com/Life-Pill/mobile-ms.git
cd mobile-ms

# 2. Setup environment
cp .env.example .env
# Edit .env with your configuration

# 3. Start all services
docker compose --env-file .env up -d

# 4. Verify services
docker compose ps
```

## Service URLs

After starting with Docker Compose:

| Service | URL |
|---------|-----|
| Eureka Dashboard | http://localhost:8761 |
| API Gateway | http://localhost:9191 |
| Identity Service Swagger | http://localhost:8085/swagger-ui/index.html |
| User Auth Swagger | http://localhost:8080/api/swagger-ui.html |
| Patient Customer Swagger | http://localhost:8070/swagger-ui.html |
| Branch Service Swagger | http://localhost:8081/swagger-ui.html |
| Inventory Service Swagger | http://localhost:8082/swagger-ui.html |
| Order Service Swagger | http://localhost:8086/swagger-ui.html |
| Prometheus | http://localhost:9090 |
| Grafana | http://localhost:3001 |
| Zipkin | http://localhost:9411 |

### Production URLs (Server: 34.59.6.212)

| Service | URL |
|---------|-----|
| Eureka Dashboard | http://34.59.6.212:8761 |
| API Gateway | http://34.59.6.212:9191 |
| User Auth Swagger | http://34.59.6.212:8080/api/swagger-ui.html |
| Patient Customer Swagger | http://34.59.6.212:8070/swagger-ui.html |
| Branch Service Swagger | http://34.59.6.212:8081/swagger-ui.html |
| Inventory Service Swagger | http://34.59.6.212:8082/swagger-ui.html |
| Identity Service Swagger | http://34.59.6.212:8085/swagger-ui.html |
| Order Service Swagger | http://34.59.6.212:8086/swagger-ui.html |
| Prometheus | http://34.59.6.212:9090 |
| Grafana | http://34.59.6.212:3001 |
| Zipkin | http://34.59.6.212:9411 |

##  Monitoring & Health Checks

### Actuator Endpoints

All services expose actuator endpoints for monitoring:

| Endpoint | Description |
|----------|-------------|
| `/actuator/health` | Health status |
| `/actuator/info` | Application info |
| `/actuator/metrics` | Metrics data |
| `/actuator/prometheus` | Prometheus format metrics |

### Service Discovery Dashboard

Access Eureka Dashboard: `http://localhost:8761`
- Username: `admin` (default)
- Password: `admin` (default)

## ğŸ”’ Security Features

### API Gateway
- Circuit Breaker pattern (Resilience4j)
- Request rate limiting
- CORS configuration
- Request/Response logging
- Authentication header relay

### Identity Service
- JWT-based authentication
- BCrypt password encoding
- PIN-based quick authentication
- Redis session caching with TTL
- Session revocation support

### Service Registry
- Basic authentication for dashboard
- Secured actuator endpoints

## ğŸ”„ Circuit Breaker Configuration

The API Gateway implements circuit breaker pattern:

```yaml
resilience4j:
  circuitbreaker:
    instances:
      userAuthCircuitBreaker:
        sliding-window-size: 5
        failure-rate-threshold: 40
        wait-duration-in-open-state: 15s
```

## ğŸ› ï¸ Technology Stack

- **Java 17**
- **Spring Boot 3.3.0**
- **Spring Cloud 2023.0.1**
- **Spring Cloud Gateway** (Reactive)
- **Netflix Eureka** (Service Discovery)
- **Spring Cloud Config** (Configuration Management)
- **Resilience4j** (Circuit Breaker)
- **Spring Data Redis** (Session Caching)
- **Micrometer + Prometheus** (Metrics)
- **PostgreSQL** (Database)
- **MongoDB** (Document Database)
- **Redis** (Session Cache)
- **Flyway** (Database Migration)
- **JWT** (Authentication)

## ğŸ“ Support

For support, email support@lifepill.com or raise an issue in the repository.

## ğŸ“„ License

This project is licensed under the MIT License.
